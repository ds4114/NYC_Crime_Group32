[["index.html", "Data Preparation Chapter 1 Introduction", " Data Preparation Group32 2022-11-18 Chapter 1 Introduction #Outline/Work/Notes Introduction - “Explain why you chose this topic, and the questions you are interested in studying. Provide context for readers who are not familiar with the topic.” Data copy proposal wording back into data section –Focus: Just around Upper Manhattan (if enough data) Profiling Describe any issues / problems with the data, either known or that you discover. NULL values - Binning for dates Potential date mismatch of when crime happened vs when crime was reported Recreate some basic statistics about the data we have using bar charts or whatever Google to see how others used dataset https://towardsdatascience.com/analysis-of-nyc-reported-crime-data-using-pandas-821753cd7e22 https://www.kaggle.com/datasets/adamschroeder/crimes-new-york-city https://jingjing-ge.medium.com/analysis-of-crime-data-in-new-york-city-in-2020-e6a65edf4429 https://www.kaggle.com/code/spoons/nyc-crime-complaints-guided-eda-with-shiny-app Data Cleaning need a metric count of crimes derived field of the distance from morningside park center to the row’s coordinate (ie. radius nearby –need another package) derived field about the severity or relcassify crime - (ex parking tickets). To reduce distinct number down to something managble. derive day of week from the datetime field date cleanups using data dictionary and maybe some assumptions so that we have a more accurate point in time (just use start) Results / Graph Ideas Univariate/Multivariate Categorical Ideas: crime frequency vs gender/age group/borough –maybe bar charts or mosaics Continuous Variable Ideas: (Interactive) changing radius from (morningside) park to see impact on crime rate density (frequency/area of radius). Take snapshots at like .25mi, .5mi, .75 etc as x-axis and plot density on y Time series (over months/days of week) - look at changes over time/seasonality (interactive) - control time lapse of heatmap of NYC or something Time (during the day) - Map: Ideas: compare NYU vs Columbia Compare walking vs subway (using premise) #Tasks 1. Get coordinates data for a specific location and use that calculate the distance from each complaint –Faizan 2. We need to assign categories to crimes –Abhi 3. Look into how best to use the time variables for various time series analyses 4. General exploration of data (via online viz or R) / take notes on missing value cleanup/interesting findings –All #Next Steps Note 2022-11-13 Agree on Data Prep Steps Derived Fields - a few for time series (Devan) - day night - was time estimated or not - crime category (Abhi) - distance from XYZ location - Columbia, NYU?, tbd (Faizan) - Aggregate Field for Premise (3-4 values, simple to use) - like street/park/inside/subway? - Combines inside/outside and premise and anythign else nee(incl. something for subway) - “Relevant Crime for EDAV” - victim is an individual and crime type is relevant or some aggregate of the two –Abhi to look at percentages and determine how to filter. May need to recategorize and/or use the victim sex field - (Other flags as needed) – Missing Value Analysis - Need to satisfy requirement for project - Describe any missing values in fields For date (Devan) - Look at difference between date reported and date of incident if anything interesting For crime type (Abhi) - There are 5 values with missing &quot;OFNS_DESC&quot;. Since they have valid PD_CD and PD_DESC, we can impute these values from other columns with the same PD_CD two values are for obscenity - 594 PD_CD. categorized as sex crimes one values for crime pos weap - 797 PD_CD. categorized as dangerous weapons one value for &quot;place false bomb&quot; - 648 PD_CD. No other examples of this crime. Ignore? one value for &quot;noise&quot; - 872 PD_CD. No other examples of this crime. Ignore? Placeholder for anything else Data Filtration Justification (missing and not relevant) Date - We only have crimes that took place (as defined by derived field above) in 1/1/2022 onward (this should remove 5%) (Devan) Crime Type - Use the derived field from above Location? - Tentative, only look within 3.2km of Columbia (per derived field above) Guiding Questions to keep in mind What is the safest route back home, - interactive component? Is cutting through the park bad? - what is a dangerous time to be out? Is there a difference by gender/race/age for safety? Analyses Demographics - 3+ (mosaic, ) –tbd to see what is interesting (All) Time - 3 graphs (line graph, ridge plot, bar chart/split?) Location - 2 graphs (map, crime density at different radiaii, routes to uptown?) -how to represent overlapping lat/long points differently? Color (Faizan) ——– Interactive - TBD, depends on complexity - Maybe user will enter address and then it will show a map that is shown around columbia and that location and basically plots heat map but allows user to add filters to make more specific and change the heatmap (ex change time or day or gender) "],["proposal.html", "Chapter 2 Proposal 2.1 Research topic 2.2 Data availability", " Chapter 2 Proposal 2.1 Research topic Have you ever gotten out of a class at 9:30pm and wondered if it was safe to walk home? Do you wonder if you should cut through a park or take the subway? Is it possible to quantify “safe”? Does your risk profile change after 10:30pm or if you are a certain gender? The motivation for this project spawned from these practical questions we had in relation to navigating NYC on and off campus. Many of our classes get out at night and we live nearby but wonder if there is a walking path home that exhibits the least risk. We want to answer these types of questions using data and visualizations. The focus of this project is to analyze NYPD crime and complaint data around Columbia during the school year. However, the data (described more in the next section) lends itself to investigate broader questions of equity by demographics and neighborhood across NYC. We also have flexibility in the time range to investigate and may look at longer trends. 2.2 Data availability NYC Open Data (NYC Office of Technology and Innovation (OTI)) in conjunction with New York City Police Department (NYPD) makes public safety data available for anyone online. In particular they publish Complaint Data which contains felony, misdemeanor, and violation crimes reported to the NYPD from 2006 till present. Year-to-Date (YTD): https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Current-Year-To-Date-/5uac-w243 Historic: https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Historic/qgea-i56i 2.2.1 Content “Complaint data” is a mixed set of records because it contains crimes (ex. robbery, rape, assault), parking violations, complaints of harassment, reports of abandoned animals, and more. We will need to investigate, clean, and filter the data to answer our research questions. As the links above indicate, there are two sets of data containing distinct records. A year-to-date dataset from 1/1/2022 to 9/30/2022 and a historic dataset containing records from 1/1/2006 to 12/31/2021. We plan to start with the year-to-date data and potentially incorporate historic records as needed. The dataset contains mostly categorical variables and dates with each row indicating a crime/violation. As of the last update on October 19, 2022, the YTD Dataset contains 397K rows and 36 columns. A data dictionary is provided by NYC Open Data at the link above. Column names and description: S.No Column Name (Data Type): Description CMPLNT_NUM (text): Randomly generated persistent ID for each complaint ADDR_PCT_CD (text): The precinct in which the incident occurred BORO_NM (text): The name of the borough in which the incident occurred CMPLNT_FR_DT (DateTime): Exact date of occurrence for the reported event (or starting date of occurrence, if CMPLNT_TO_DT exists) CMPLNT_FR_TM (text): Exact time of occurrence for the reported event (or starting time of occurrence, if CMPLNT_TO_TM exists) CMPLNT_TO_DT (DateTime): Ending date of occurrence for the reported event, if exact time of occurrence is unknown CMPLNT_TO_TM (text): Ending time of occurrence for the reported event, if exact time of occurrence is unknown CRM_ATPT_CPTD_CD (text): Indicator of whether crime was successfully completed or attempted, but failed or was interrupted prematurely HADEVELOPT (text): Name of NYCHA housing development of occurrence, if applicable HOUSING_PSA (Number): Development Level CodeNumber JURISDICTION_CODE (Number): Jurisdiction responsible for incident. Either internal, like Police(0), Transit(1), and Housing(2); or external(3), like Correction, Port Authority, etc. JURIS_DESC (text): Description of the jurisdiction code KY_CD (Number): Three digit offense classification code LAW_CAT_CD (text): Level of offense: felony, misdemeanor, violation LOC_OF_OCCUR_DESC (text): Specific location of occurrence in or around the premises; inside, opposite of, front of, rear of OFNS_DESC (text): Description of offense corresponding with key code PARKS_NM (text): Name of NYC park, playground or greenspace of occurrence, if applicable (state parks are not included) PATROL_BORO (text): The name of the patrol borough in which the incident occurred PD_CD (Number): Three digit internal classification code (more granular than Key Code) PD_DESC (text): Description of internal classification corresponding with PD code (more granular than Offense Description) PREM_TYP_DESC (text): Specific description of premises; grocery store, residence, street, etc. RPT_DT (DateTime): Date event was reported to police STATION_NAME (text): Transit station name SUSP_AGE_GROUP (text): Suspect’s Age Group SUSP_RACE (text): Suspect’s Race Description SUSP_SEX (text): Suspect’s Sex Description TRANSIT_DISTRICT (Number): Transit district in which the offense occurred VIC_AGE_GROUP (text): Victim’s Age Group VIC_RACE (text): Victim’s Race Description VIC_SEX (text): Victim’s Sex Description X_COORD_CD (Number): X-coordinate for New York State Plane Coordinate System, Long Island Zone, NAD 83, units feet (FIPS 3104) Y_COORD_CD (Number): Y-coordinate for New York State Plane Coordinate System, Long Island Zone, NAD 83, units feet (FIPS 3104) Latitude (Number): Midblock Latitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326) Longitude (Number): Midblock Longitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326) LatLon (Location) New Georeferenced Column (Point) 2.2.2 Who Collects The Data The data was collected and published by the NY Police Department (NYPD). 2.2.3 Format and Importation OTI provides the data in 4 formats: 1) online table, 2) visualization, 3) CSV, and 4) API. The first two have limited functionality and customization so we will not use those versions. The API requires an account and authentication tokens. Given that the CSV for YTD data is not too large (140MB), it seems the easiest to work with. CSV is a format we are most familiar with and one that R handles well. Is there a difference between CSV and API? Yes. Not in number of observations but in the columns. With the CSV, we get a total of 36 columns (listed above) but with the API we get a total of 41 columns. Following are the columns that are present in the CSV data but not in the API data: New Georeferenced Column. Following are the columns that are present in the API data but not in the CSV data: :@computed_region_92fq_4b7q :@computed_region_yeji_bk3q :@computed_region_efsh_h5xi geocoded_column :@computed_region_sbqj_enih :@computed_region_f5dn_yrer 2.2.4 Updates This dataset was first made public on 11/1/2018. It is updated quarterly. It appears that the metadata is updated more frequently but it is not clear what changes are incorporated as there could be several updates made in Oct 2022 but the data will only contain records up to the prior month end of Sept 2022. 2.2.5 Expected Challenges The data does not have many continuous variables. We will have to derive one based on counts and may need to supplement with other data to obtain others (ex. average cost/insurance per type of crime). There are longitude and latitude fields which we would like to utilize but have not identified an R package to process and visualize. library(tidyverse) ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ── ## ✔ ggplot2 3.3.6 ✔ purrr 0.3.4 ## ✔ tibble 3.1.8 ✔ dplyr 1.0.10 ## ✔ tidyr 1.2.0 ✔ stringr 1.4.1 ## ✔ readr 2.1.2 ✔ forcats 0.5.2 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## ✖ dplyr::filter() masks stats::filter() ## ✖ dplyr::lag() masks stats::lag() library(ggplot2) library(dplyr) library(lubridate) ## ## Attaching package: &#39;lubridate&#39; ## ## The following objects are masked from &#39;package:base&#39;: ## ## date, intersect, setdiff, union library(ggridges) library(geosphere) ## Warning: package &#39;geosphere&#39; was built under R version 4.2.2 #Unused Libraries: #library(readr) #Group32 - This file has been added to gitignore so it will not be uploaded. So we are on the same page and can run the same code, add the csv to your local project folder in a new subfolder &quot;data&quot;. df_raw &lt;- read_csv(&#39;./data/NYPD_Complaint_Data_Current__Year_To_Date_.csv&#39;) ## Warning: One or more parsing issues, see `problems()` for details ## Rows: 396978 Columns: 36 ## ── Column specification ──────────────────────────────────────────────────────── ## Delimiter: &quot;,&quot; ## chr (24): BORO_NM, CMPLNT_FR_DT, CMPLNT_TO_DT, CMPLNT_TO_TM, CRM_ATPT_CPTD_... ## dbl (11): CMPLNT_NUM, ADDR_PCT_CD, HOUSING_PSA, JURISDICTION_CODE, KY_CD, P... ## time (1): CMPLNT_FR_TM ## ## ℹ Use `spec()` to retrieve the full column specification for this data. ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. #View(df_raw) #head(df_raw) #Data Standardization Contents Re-categorize and clean Offense Type Derive Date/Time fields #Offense Type ##Imputing null values For crime type (Abhi) - There are 5 values with missing “OFNS_DESC”. Since they have valid PD_CD and PD_DESC, we can impute these values from other columns with the same PD_CD two values are for obscenity - 594 PD_CD. categorized as sex crimes one values for crime pos weap - 797 PD_CD. categorized as dangerous weapons one value for “place false bomb” - 648 PD_CD. No other examples of this crime. Ignore? one value for “noise” - 872 PD_CD. No other examples of this crime. Ignore? df &lt;- df_raw df$OFNS_DESC[df$CMPLNT_NUM %in% c(&quot;248613125&quot;, &quot;248290778&quot;)] &lt;- &quot;SEX CRIMES&quot; df$OFNS_DESC[df$CMPLNT_NUM %in% (&quot;246605653&quot;)] &lt;- &quot;DANGEROUS WEAPONS&quot; df &lt;- df[df$CMPLNT_NUM != &quot;243170965&quot;,] df &lt;- df[df$CMPLNT_NUM != &quot;245874611&quot;,] ##Creating a new column to bucket crimes df &lt;- df %&gt;% mutate(CRIME_CAT = case_when( OFNS_DESC %in% c(&quot;RAPE&quot;, &quot;SEX CRIMES&quot;, &quot;HARRASSMENT 2&quot;, &quot;FELONY SEX CRIMES&quot;, &quot;PROSTITUTION &amp; RELATED OFFENSES&quot;) ~ &quot;SEX CRIMES&quot;, OFNS_DESC %in% c(&quot;DANGEROUS DRUGS&quot;,&quot;CANNABIS RELATED OFFENSES&quot;,&quot;INTOXICATED &amp; IMPAIRED DRIVING&quot;,&quot;ALCOHOLIC BEVERAGE CONTROL LAW&quot;,&quot;INTOXICATED/IMPAIRED DRIVING&quot;) ~ &quot;DRUG AND ALCOHOL RELATED&quot;, OFNS_DESC %in% c(&quot;ROBBERY&quot;,&quot;GRAND LARCENY&quot;,&quot;THEFT-FRAUD&quot;,&quot;PETIT LARCENY&quot;,&quot;BURGLARY&quot;,&quot;GRAND LARCENY OF MOTOR VEHICLE&quot;,&quot;POSSESSION OF STOLEN PROPERTY&quot;,&quot;THEFT OF SERVICES&quot;,&quot;BURGLAR&#39;S TOOLS&quot;,&quot;PETIT LARCENY OF MOTOR VEHICLE&quot;,&quot;OTHER OFFENSES RELATED TO THEF&quot;) ~ &quot;THEFT OR BURGLARY&quot;, OFNS_DESC %in% c(&quot;DANGEROUS WEAPONS&quot;,&quot;MURDER &amp; NON-NEGL. MANSLAUGHTER&quot;,&quot;KIDNAPPING &amp; RELATED OFFENSES&quot;,&quot;HOMICIDE-NEGLIGENT,UNCLASSIFIE&quot;,&quot;HOMICIDE-NEGLIGENT-VEHICLE&quot;,&quot;KIDNAPPING&quot;,&quot;FELONY ASSAULT&quot;,&quot;ARSON&quot;,&quot;ASSAULT 3 &amp; RELATED OFFENSES&quot;,&quot;UNLAWFUL POSS. WEAP. ON SCHOOL&quot;) ~ &quot;MAJOR VIOLENT CRIMES&quot;, OFNS_DESC %in% c(&quot;CRIMINAL MISCHIEF &amp; RELATED OF&quot;,&quot;UNAUTHORIZED USE OF A VEHICLE&quot;,&quot;FRAUDS&quot;,&quot;OFFENSES AGAINST PUBLIC SAFETY&quot;,&quot;DISORDERLY CONDUCT&quot;,&quot;JOSTLING&quot;,&quot;DISRUPTION OF A RELIGIOUS SERV&quot;,&quot;ESCAPE 3&quot;,&quot;OFF. AGNST PUB ORD SENSBLTY &amp;&quot;,&quot;CRIMINAL TRESPASS&quot;,&quot;VEHICLE AND TRAFFIC LAWS&quot;,&quot;GAMBLING&quot;,&quot;OFFENSES AGAINST THE PERSON&quot;,&quot;OFFENSES INVOLVING FRAUD&quot;,&quot;FRAUDULENT ACCOSTING&quot;,&quot;ANTICIPATORY OFFENSES&quot;,&quot;LOITERING/GAMBLING (CARDS, DIC&quot;) ~ &quot;FRAUD/GAMBLING AND MISC&quot;, OFNS_DESC %in% c(&quot;NYS LAWS-UNCLASSIFIED FELONY&quot;,&quot;MISCELLANEOUS PENAL LAW&quot;,&quot;FORGERY&quot;,&quot;OFFENSES AGAINST PUBLIC ADMINI&quot;,&quot;CHILD ABANDONMENT/NON SUPPORT&quot;,&quot;NYS LAWS-UNCLASSIFIED VIOLATION&quot;,&quot;OTHER STATE LAWS&quot;,&quot;OTHER STATE LAWS (NON PENAL LAW)&quot;,&quot;NEW YORK CITY HEALTH CODE&quot;,&quot;ADMINISTRATIVE CODE&quot;,&quot;OTHER STATE LAWS (NON PENAL LA&quot;,&quot;AGRICULTURE &amp; MRKTS LAW-UNCLASSIFIED&quot;,&quot;ENDAN WELFARE INCOMP&quot;,&quot;OFFENSES RELATED TO CHILDREN&quot;) ~&quot;OTHER&quot;)) #Date/Time ##Cleaning null values/ranges Per the data dictionary, there is a “from” date and a “to” when the exact time is unknown. There is also a “report date” for when the crime was reported. Using these fields, we can derive a new clean field that is the assumed date of the incident. Assumptions: When there is a range, we will use the “from” date because is populated well and will on average approximate the frequency of crime over time; when from date is null, we will use the report date. df &lt;- df %&gt;% mutate( #use from date and report date if null. If to_date then just use from date and we can argue it averages out since new reports will start as other end Incident_Date_raw = case_when (is.null(CMPLNT_FR_DT) ~ RPT_DT ,CMPLNT_FR_DT == &quot;(null)&quot; ~ RPT_DT ,TRUE ~ CMPLNT_FR_DT ) #flag if estimated (ie from date is null or to date is populated) ,Incident_Date_Estimated_Flag = case_when ( is.null(CMPLNT_FR_DT) ~ &#39;Y&#39; ,CMPLNT_FR_DT == &quot;(null)&quot; ~ &#39;Y&#39; ,!is.null(CMPLNT_TO_DT) ~ &#39;Y&#39; ,CMPLNT_TO_DT != &quot;(null)&quot; ~ &#39;Y&#39; ,TRUE ~ &#39;N&#39; ) ) #Convert to times df &lt;- df %&gt;% mutate( #creating date and time together for lubridate Incident_Date = as.Date(Incident_Date_raw, format = &#39;%m/%d/%Y&#39;) ,Incident_Datetime = as.POSIXct(paste(Incident_Date_raw,CMPLNT_FR_TM), format = &#39;%m/%d/%Y %H:%M:%S&#39;) ) %&gt;% mutate( Incident_HourTime = hour(Incident_Datetime) + minute(Incident_Datetime)/60 ,Incident_Month = month(Incident_Date) ,Incident_DayOfWeek = wday(Incident_Date, label = TRUE, abbr = TRUE) ) #GeoLocation Fields #add column for Columbia location CU_Latitude = 40.807384 CU_Longitude = -73.963036 #df_test = df[1:10,] #df_test$dist_to_CU &lt;- apply(df_test, 1, function(x)distm(c(x[which( colnames(df)==&quot;Longitude&quot;)],x[which(colnames(df)==&quot;Latitude&quot;)]),c(x[which( colnames(df)==&quot;CU_Longitude&quot;)],x[which( colnames(df)==&quot;CU_Latitude&quot;)]),fun = distGeo)) df$dist_to_CU &lt;- apply(df, 1, function(x)distm(c(x[which( colnames(df)==&quot;Longitude&quot;)],x[which(colnames(df)==&quot;Latitude&quot;)]),c(CU_Longitude,CU_Latitude),fun = distGeo)) –#TODO can we speed this up? Takes about 5 mins to run #Other Derivations Here we will add additional fields for more classification –#TODO add more description df &lt;- df %&gt;% mutate( #get a flag for outside vs inside Inside_Outside = case_when ( LOC_OF_OCCUR_DESC %in% c(&quot;FRONT OF&quot; , &quot;OPPOSITE OF&quot; , &quot;REAR OF&quot;) ~ &quot;OUTSIDE&quot; ,LOC_OF_OCCUR_DESC %in% c(&quot;INSIDE&quot;) ~ &quot;INSIDE&quot; #,LOC_OF_OCCUR_DESC == &quot;(null)&quot; ~ NULL #TODO -cant figure this out error ,TRUE ~ LOC_OF_OCCUR_DESC ) #if victim was a person (not a business/govt) ,VIC_Individual_Flag = case_when ( VIC_SEX %in% c(&quot;M&quot;,&quot;F&quot;,&quot;L&quot;) ~ &#39;Y&#39; ,TRUE ~ &#39;N&#39; ) ) %&gt;% mutate( Complaint_Count = 1 #maybe want to add like a intensity value or something? #TODO, make this field a little better/check values? ,Premise_Derived = case_when ( Inside_Outside == &#39;INSIDE&#39; ~ &#39;INSIDE&#39; ,PREM_TYP_DESC ==&quot;RESIDENCE - APT. HOUSE&quot; &amp; (Inside_Outside == &quot;(null)&quot; | is.null(Inside_Outside)) ~ &#39;INSIDE&#39; ,!is.null(PARKS_NM) &amp; PARKS_NM != &quot;(null)&quot; ~ &#39;PARK&#39; ,PREM_TYP_DESC %in% c(&quot;TRANSIT - NYC SUBWAY&quot;,&quot;BUS (NYC TRANSIT)&quot;,&quot;TRANSIT FACILITY (OTHER)&quot;) ~ &#39;SUBWAY&#39; ,TRUE ~ &#39;STREET&#39; ) ) #Select and Rename Columns in a Usuable Table –#TODO add more description #Filter Table for Relevance –#TODO add more description "],["data.html", "Chapter 3 Data 3.1 Sources 3.2 Cleaning / transformation 3.3 Missing value analysis", " Chapter 3 Data 3.1 Sources 3.2 Cleaning / transformation 3.3 Missing value analysis "],["results.html", "Chapter 4 Results", " Chapter 4 Results "],["interactive-component.html", "Chapter 5 Interactive component", " Chapter 5 Interactive component "],["conclusion.html", "Chapter 6 Conclusion", " Chapter 6 Conclusion "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
